# Техническое задание кандитата Лощёва Захара по созданию парсера auchan.ru

## Содержание
- [Постановка задачи](#постановка-задачи)
- [Структура проекта](#структура-проекта)
- [Структура результатов](#структура-результатов)
- [Замечания](#замечания)
- [Инструкция по запуску](#инструкция-по-запуску)

## Постановка задачи
Необходимо выполнить одно задание из трех предложенных.
1. Normal. Написать парсер для сайта Ашан (https://www.auchan.ru/)

Для каждой торговой площадки требования одни и те же. Спарсить любую категорию, где более 100 товаров, для городов Москва и Санкт-Петербург и выгрузить в любой удобный формат(csv, json, xlsx). Важно, чтобы товары были в наличии.

Необходимые данные: 

- id товара из сайта/приложени
- наименование, 
- ссылка на товар, 
- регулярная цена, 
- промо цена, 
- бренд.

## Структура проекта
```bash
.
├── app
│   ├── config.py
│   ├── main.py
│   ├── parsers
│   │   ├── __init__.py
│   │   └── parser.py
│   └── scraper.py
├── requirements.txt
└── results
    ├── Колбасные изделия
    │   ├── Колбасы_ветчина_moscow_14_10_2023.json
    │   └── Колбасы_ветчина_spb_14_10_2023.json
    ├── Овощи, фрукты, орехи
    │   ├── Сейчас_сезон_moscow_14_10_2023.json
    │   └── Сейчас_сезон_spb_14_10_2023.json
    └── Сыр
        ├── Сыры_твердые_и_полутвердые_moscow_14_10_2023.json
        └── Сыры_твердые_и_полутвердые_spb_14_10_2023.json
```
- `app/config.py` - файл с глобальными переменными
- `app/main.py` - точка входа программы
- `app/parsers/parser.py` - парсер .html кода подкатегории основной категории товаров (Главная > Колбасные изделия > `Колбасы, ветчина`)
- `app/scraper.py` - веб-скрапер реализованный с помощью `Selenium` использующий `undetected-chromedriver` для обхода антипарсинг защиты
- `requirements.txt` - файл с зависимостями для `pip`
- `results/` - директория содержащая результаты, где название поддиректории обозначает основную категорию товаров, а файлы в поддиректориях есть подкатегории имеющие формат `json`

## Структура результатов
`json` файлы имеют следующую структуру:
```json
{
  "subcategory": "Сыры твердые и полутвердые",
  "count": 367,
  "region": "Москва и область",
  "products": [
    {
      "id": 333922,
      "name": "Сыр полутвердый Bonfesto Mozzarella Pizza 40% БЗМЖ, 250 г",
      "link": "https://auchan.ru/product/syr-polutverdyy-bonfesto-mozzarella-pizza-40-250-g/",
      "price": "278.99",
      "promo_price": null,
      "brand": "Bonfesto"
    },
    {...},
  ]
}
```
## Замечания
**ВНИМАНИЕ!** Перед началом удостоверьтесь, что у вас установлен браузер `chrome` или путь к экзешнику браузера прописан в `PATH`
- Для скрапинга использовалась следующая версия `chrome`: **Версия 118.0.5993.71 (Официальная сборка), (64 бит)** и соотвествующая ему версия `chromedriver`
- Обратите внимание, что браузер будет запускаться не в **headless** режиме для обхода **антипарсинг защиты Qrator** сайта Ашан (https://www.auchan.ru)
- По выше изложенной причине **headless** запуск на VPS/VDS серверах не предусмотрен

## Инструкция по запуску
1. Клонировать репозиторий
```
git clone https://github.com/kxcoze/task_parser
```
2. Перейти в папку репозитория
```
cd task_parser/
```
3. Установить зависимости в виртуальном окружении
```
python -m "venv" venv
source venv/bin/activate
pip install -r requirements.txt
```
4. Запустить главный скрипт **ВНИМАНИЕ!** Скрипт установит сам `chromedriver` подходящий к вашей версии браузера chrome. Если вас это беспокоит, то следует запустить скрипт с аргументом `--autoinstall=0` 
```sh
python app/main.py
```
или
```sh
python app/main.py --autoinstall=0  # В случаях когда chromedriver уже установлен
```
